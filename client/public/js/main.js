import{info}from"./config.js";import{renderMessage}from"./helpers.js";import*as Render from"./render-elements.js";Render.renderGameMenu();var ws=new WebSocket("ws://".concat(info.hostname).concat(info.port,"/"));ws.onopen=onWsOpen;ws.onmessage=onWsMessage;ws.onerror=onWsError;ws.onclose=onWsClose;var player;var isGameRunning=false;function sendToServer(obj){ws.send(JSON.stringify(obj))}function onWsOpen(){console.log("Connection established")}function onWsMessage(message){var jsonFromServer=JSON.parse(message.data);var{eventFromServer}=jsonFromServer;if(eventFromServer==="gameState"){var{gameState:stringGameState,playerNumber}=jsonFromServer;var gameState=JSON.parse(stringGameState);if(!isGameRunning){Render.unrenderGameMenu();Render.unrenderGameOverMenu();Render.renderGameScreen(gameState);player=playerNumber;isGameRunning=true;return}Render.renderGame(gameState,playerNumber);return}if(eventFromServer==="responseNewRoom"){var{roomId}=jsonFromServer;console.log("Server new room created: ".concat(roomId));Render.renderRoomId(roomId);player="p1";return}if(eventFromServer==="denialJoinRoom"){var{reason}=jsonFromServer;Render.renderJoinFormPopup(reason);return}if(eventFromServer==="invalidNewGameForm"){Render.renderBtnNewGamePopup("server-invalid-form");return}if(eventFromServer==="invalidJoinGameForm"){Render.renderJoinFormPopup("server-invalid-form");return}if(eventFromServer==="roomDestroyed"){var{reason:_reason}=jsonFromServer;console.log("Room destroyed reason: ".concat(_reason));Render.unrenderGame();Render.unrenderGameOverMenu();if(_reason){Render.renderGameMenu(false,"btn-create__popup--".concat(_reason))}else{Render.renderGameMenu()}isGameRunning=false;player=null;return}if(eventFromServer==="gameOver"){var{gameState:_stringGameState,playerNumber:_playerNumber}=jsonFromServer;var _gameState=JSON.parse(_stringGameState);Render.unrenderGameMenu();Render.unrenderGame();Render.renderGameOverMenu(_gameState.winPlayer,_playerNumber);isGameRunning=false;return}if(eventFromServer==="askPlayAgain"){console.log("Other player asked to play again");Render.renderAskPlayAgain()}}function onWsError(){console.log("Connection error");requestAnimationFrame(()=>renderMessage("Connection Error"))}function onWsClose(){console.log("Connection close");requestAnimationFrame(()=>renderMessage("Connection Error"))}function getPlayerNumber(){return player}export{sendToServer,getPlayerNumber};